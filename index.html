<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DIX</title>

<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:system-ui}

body{
  background:#004d33;
  color:white;
  min-height:100vh;
}

/* HEADER */
header{
  background:#000;
  padding:18px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.logo{
  font-size:30px;
  font-weight:800;
  color:#39ff14;
}

.search{
  width:170px;
  padding:10px 14px;
  border-radius:16px;
  border:none;
  background:#1a1a1a;
  color:white;
}

/* NOTES GRID */
main{
  padding:18px;
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(170px,1fr));
  gap:16px;
  justify-items:center;
}

/* PREVIEW */
.note{
  background:#353839;
  width:100%;
  min-height:90px;
  border-radius:20px;
  padding:14px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:600;
  text-align:center;
  cursor:pointer;
}

/* ADD BUTTON */
.add-btn{
  position:fixed;
  bottom:22px;
  right:22px;
  width:64px;
  height:64px;
  border-radius:50%;
  background:#000;
  color:#004d33;
  font-size:36px;
  border:none;
}

/* MODAL */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.85);
  display:none;
  justify-content:center;
  align-items:flex-start;
  overflow-y:auto;
  padding:30px 0;
}

.modal.active{display:flex}

.card{
  background:#0f0f0f;
  width:90%;
  max-width:420px;
  border-radius:26px;
  padding:20px;
  display:flex;
  flex-direction:column;
  gap:14px;
}

/* INPUTS */
input,textarea{
  background:#1c1c1c;
  border:1px solid #333;
  border-radius:16px;
  padding:12px;
  color:white;
}

textarea{
  resize:none;
  min-height:140px;
}

/* MEDIA */
.media-list{
  display:flex;
  flex-direction:column;
  gap:12px;
}

.media-item{
  position:relative;
}

.media-item img,
.media-item video{
  width:100%;
  border-radius:16px;
}

.media-item button{
  position:absolute;
  top:6px;
  right:6px;
  background:rgba(0,0,0,.7);
  color:white;
  border:none;
  border-radius:50%;
  width:28px;
  height:28px;
  font-size:16px;
}

/* VIEW MODE */
.view-title{
  font-size:14px;
  opacity:.6;
}

.view-text{
  font-size:22px;
  line-height:1.5;
  white-space:pre-wrap;
}

/* ACTIONS */
.actions{
  display:flex;
  gap:10px;
}

.btn{
  flex:1;
  padding:12px;
  border-radius:18px;
  border:none;
  background:#222;
  color:white;
}

.delete{background:#ff3b3b}
</style>
</head>

<body>

<header>
  <div class="logo">DIX</div>
  <input class="search" placeholder="Поиск">
</header>

<main id="notes"></main>

<button class="add-btn">+</button>

<div class="modal" id="modal">
  <div class="card" id="card">
    <div id="viewTitle" class="view-title"></div>
    <div id="viewText" class="view-text"></div>

    <input id="title" placeholder="Тема">
    <textarea id="text" placeholder="Текст заметки"></textarea>

    <input type="file" id="media" accept="image/*,video/*" multiple>
    <div class="media-list" id="mediaList"></div>

    <div class="actions">
      <button class="btn" id="close">✖</button>
      <button class="btn delete" id="delete">Удалить</button>
      <button class="btn" id="save">Сохранить</button>
    </div>
  </div>
</div>

<script>
let notes=JSON.parse(localStorage.getItem('notes')||'[]');
let current=null;
let mediaArr=[];

const notesEl=document.getElementById('notes');
const modal=document.getElementById('modal');
const titleInput=document.getElementById('title');
const textInput=document.getElementById('text');
const mediaInput=document.getElementById('media');
const mediaList=document.getElementById('mediaList');
const viewTitle=document.getElementById('viewTitle');
const viewText=document.getElementById('viewText');

function render(){
  notesEl.innerHTML='';
  notes.forEach((n,i)=>{
    const d=document.createElement('div');
    d.className='note';
    d.textContent=n.title;
    d.onclick=()=>openNote(i);
    notesEl.appendChild(d);
  });
}

function openNote(i){
  current=i;
  const n=notes[i];
  titleInput.value=n.title;
  textInput.value=n.text;
  viewTitle.textContent=n.title;
  viewText.textContent=n.text;
  mediaArr=[...n.media];
  drawMedia();
  modal.classList.add('active');
}

document.querySelector('.add-btn').onclick=()=>{
  current=null;
  titleInput.value='';
  textInput.value='';
  viewTitle.textContent='';
  viewText.textContent='';
  mediaArr=[];
  drawMedia();
  modal.classList.add('active');
};

document.getElementById('close').onclick=()=>modal.classList.remove('active');

document.getElementById('save').onclick=()=>{
  if(!titleInput.value.trim())return;
  const note={title:titleInput.value,text:textInput.value,media:mediaArr};
  current!==null?notes[current]=note:notes.push(note);
  localStorage.setItem('notes',JSON.stringify(notes));
  modal.classList.remove('active');
  render();
};

document.getElementById('delete').onclick=()=>{
  if(current===null)return;
  notes.splice(current,1);
  localStorage.setItem('notes',JSON.stringify(notes));
  modal.classList.remove('active');
  render();
};

mediaInput.onchange=()=>{
  [...mediaInput.files].forEach(f=>{
    mediaArr.push({type:f.type,url:URL.createObjectURL(f)});
  });
  drawMedia();
};

function drawMedia(){
  mediaList.innerHTML='';
  mediaArr.forEach((m,i)=>{
    const d=document.createElement('div');
    d.className='media-item';
    d.innerHTML=
      (m.type.startsWith('image')
      ?`<img src="${m.url}">`
      :`<video src="${m.url}" controls></video>`)
      +`<button onclick="removeMedia(${i})">✖</button>`;
    mediaList.appendChild(d);
  });
}

window.removeMedia=i=>{
  mediaArr.splice(i,1);
  drawMedia();
};

/* SEARCH (НЕ ЛОМАЕТ ДОСТУП) */
document.querySelector('.search').oninput=e=>{
  const q=e.target.value.toLowerCase();
  [...notesEl.children].forEach((el,i)=>{
    const n=notes[i];
    el.style.display=
      n.title.toLowerCase().includes(q)||
      n.text.toLowerCase().includes(q)
      ?'flex':'none';
  });
};

/* SWIPE TO CLOSE */
let startX=0;
document.getElementById('card').addEventListener('touchstart',e=>{
  startX=e.touches[0].clientX;
});
document.getElementById('card').addEventListener('touchend',e=>{
  if(e.changedTouches[0].clientX-startX<-80)
    modal.classList.remove('active');
});

render();
</script>

</body>
</html>