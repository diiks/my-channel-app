<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DIX</title>
<style>
* {box-sizing:border-box;margin:0;padding:0;font-family:system-ui;}
body {
  background:#004d33;
  color:white;
  min-height:100vh;
}

header{
  background:#000;
  padding:16px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.logo{
  font-size:30px;
  font-weight:800;
  color:#39ff14;
}

.search{
  width:55%;
  padding:10px 14px;
  border-radius:14px;
  border:none;
  background:#1a1a1a;
  color:white;
  font-size:16px;
}

.container{
  max-width:480px;
  margin:0 auto;
  padding:16px;
}

.notes{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:14px;
}

.note-preview{
  background:#000;
  border-radius:18px;
  padding:14px;
  font-weight:600;
  min-height:90px;
  display:flex;
  align-items:center;
  justify-content:center;
  text-align:center;
  cursor:pointer;
}

.add-btn{
  position:fixed;
  bottom:24px;
  right:24px;
  width:64px;
  height:64px;
  border-radius:50%;
  background:#000;
  color:#004d33;
  font-size:36px;
  border:none;
  cursor:pointer;
}

.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  justify-content:center;
  align-items:center;
}

.modal.active{
  display:flex;
}

.modal-content{
  background:#0f0f0f;
  width:92%;
  max-height:85vh;
  border-radius:18px;
  padding:16px;
  display:flex;
  flex-direction:column;
  overflow:hidden;
}

.modal-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.modal-header button{
  background:#2d2d35;
  border:none;
  color:#fff;
  padding:8px 14px;
  border-radius:12px;
}

.modal-body{
  margin-top:12px;
  overflow-y:auto;
}

.input{
  width:100%;
  background:#1c1c1c;
  border:none;
  border-radius:14px;
  padding:12px;
  color:white;
  margin-bottom:10px;
}

.textarea{
  min-height:120px;
  resize:none;
}

.media{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  margin-top:8px;
}

.media-item{
  position:relative;
}

.media-item img,
.media-item video{
  width:120px;
  border-radius:12px;
}

.media-item span{
  position:absolute;
  top:4px;
  right:4px;
  background:rgba(0,0,0,.7);
  padding:2px 6px;
  border-radius:50%;
  cursor:pointer;
}

.actions{
  display:flex;
  justify-content:space-between;
  margin-top:12px;
}

.btn{
  flex:1;
  margin:0 4px;
  padding:12px;
  border-radius:14px;
  border:none;
  color:white;
  background:#2d2d35;
}

.btn.delete{background:#b63636;}
</style>
</head>
<body>

<header>
  <div class="logo">DIX</div>
  <input class="search" placeholder="Поиск..." />
</header>

<div class="container">
  <div class="notes" id="notes"></div>
</div>

<button class="add-btn" id="addBtn">+</button>

<div class="modal" id="modal">
  <div class="modal-content" id="modalContent">
    <div class="modal-header">
      <button id="closeBtn">✕</button>
      <button id="saveBtn">Сохранить</button>
    </div>

    <div class="modal-body">
      <input class="input" id="title" placeholder="Тема" />
      <textarea class="input textarea" id="text" placeholder="Текст заметки"></textarea>

      <input type="file" id="mediaInput" multiple accept="image/*,video/*" />
      <div class="media" id="media"></div>
    </div>

    <div class="actions">
      <button class="btn delete" id="deleteBtn">Удалить</button>
    </div>
  </div>
</div>

<script>
const notesEl = document.getElementById('notes');
const modal = document.getElementById('modal');
const titleInput = document.getElementById('title');
const textInput = document.getElementById('text');
const mediaInput = document.getElementById('mediaInput');
const mediaEl = document.getElementById('media');

let notes = JSON.parse(localStorage.getItem('notes') || '[]');
let currentId = null;
let mediaFiles = [];

function saveStorage(){localStorage.setItem('notes',JSON.stringify(notes));}

function renderNotes(filter=''){
  notesEl.innerHTML='';
  notes.filter(n => (n.title||'').toLowerCase().includes(filter))
    .forEach(note=>{
      const div=document.createElement('div');
      div.className='note-preview';
      div.textContent=note.title;
      div.onclick=()=>openNote(note.id);
      notesEl.appendChild(div);
    });
}

function openNote(id){
  const note=notes.find(n=>n.id===id);
  if(!note)return;
  currentId=id;
  titleInput.value=note.title;
  textInput.value=note.text;
  mediaFiles=Array.isArray(note.media)?note.media:[];
  renderMedia();
  modal.classList.add('active');
}

function renderMedia(){
  mediaEl.innerHTML='';
  mediaFiles.forEach((m,i)=>{
    const div=document.createElement('div');
    div.className='media-item';
    div.innerHTML=`
      ${m.type.startsWith('image')?`<img src="${m.src}">`:`<video src="${m.src}" controls></video>`}
      <span onclick="removeMedia(${i})">✕</span>
    `;
    mediaEl.appendChild(div);
  });
}

window.removeMedia=i=>{
  mediaFiles.splice(i,1);
  renderMedia();
};

document.getElementById('addBtn').onclick=()=>{
  currentId=null;
  titleInput.value='';
  textInput.value='';
  mediaFiles=[];
  renderMedia();
  modal.classList.add('active');
};

document.getElementById('closeBtn').onclick=()=>modal.classList.remove('active');

document.getElementById('saveBtn').onclick=()=>{
  if(!titleInput.value.trim()) return;
  if(currentId){
    const n=notes.find(n=>n.id===currentId);
    Object.assign(n,{title:titleInput.value,text:textInput.value,media:mediaFiles});
  }else{
    notes.push({id:Date.now(),title:titleInput.value,text:textInput.value,media:mediaFiles});
  }
  saveStorage();
  renderNotes();
  modal.classList.remove('active');
};

document.getElementById('deleteBtn').onclick=()=>{
  if(!currentId)return;
  notes=notes.filter(n=>n.id!==currentId);
  saveStorage();
  renderNotes();
  modal.classList.remove('active');
};

mediaInput.onchange=e=>{
  [...e.target.files].forEach(f=>{
    const reader=new FileReader();
    reader.onload=ev=>{
      mediaFiles.push({src:ev.target.result,type:f.type});
      renderMedia();
    };
    reader.readAsDataURL(f);
  });
};

document.querySelector('.search').oninput=e=>renderNotes(e.target.value.toLowerCase());

renderNotes();
</script>

</body>
</html>