<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Notes App</title>
    <style>
        /* Базовые стили для работы интерфейса */
        body { font-family: sans-serif; margin: 0; padding: 20px; background: #f0f0f0; }
        .search { width: 100%; padding: 10px; margin-bottom: 20px; border-radius: 8px; border: 1px solid #ccc; }
        #notesEl { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; }
        .note-card { background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); cursor: pointer; }
        
        /* Модальное окно */
        #modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); align-items: center; justify-content: center; }
        #modal.active { display: flex; }
        #card { background: white; padding: 20px; border-radius: 15px; width: 90%; max-width: 500px; max-height: 80vh; overflow-y: auto; position: relative; }
        
        /* Медиа элементы */
        #mediaList { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; }
        .media-item { position: relative; width: 80px; height: 80px; }
        .media-item img, .media-item video { width: 100%; height: 100%; object-fit: cover; border-radius: 5px; }
        .media-item button { position: absolute; top: -5px; right: -5px; background: red; color: white; border: none; border-radius: 50%; cursor: pointer; }
        
        .add-btn { position: fixed; bottom: 20px; right: 20px; width: 60px; height: 60px; border-radius: 50%; background: #007bff; color: white; font-size: 30px; border: none; cursor: pointer; }
        .controls { margin-top: 20px; display: flex; gap: 10px; }
        input, textarea { width: 100%; margin-bottom: 10px; display: block; }
    </style>
</head>
<body>

    <input type="text" class="search" placeholder="Поиск заметок...">
    
    <div id="notesEl"></div>

    <button class="add-btn">+</button>

    <div id="modal">
        <div id="card">
            <h2 id="viewTitle"></h2>
            <p id="viewText"></p>
            
            <input type="text" id="titleInput" placeholder="Заголовок">
            <textarea id="textInput" placeholder="Текст заметки" rows="5"></textarea>
            
            <input type="file" id="mediaInput" multiple accept="image/*,video/*">
            <div id="mediaList"></div>

            <div class="controls">
                <button id="save">Сохранить</button>
                <button id="delete" style="background: #ff4444; color: white;">Удалить</button>
                <button id="close">Закрыть</button>
            </div>
        </div>
    </div>

<script>
    let notes = JSON.parse(localStorage.getItem('notes')) || [];
    let current = null;
    let mediaArr = [];

    const notesEl = document.getElementById('notesEl');
    const modal = document.getElementById('modal');
    const titleInput = document.getElementById('titleInput');
    const textInput = document.getElementById('textInput');
    const viewTitle = document.getElementById('viewTitle');
    const viewText = document.getElementById('viewText');
    const mediaList = document.getElementById('mediaList');
    const mediaInput = document.getElementById('mediaInput');

    // Вспомогательная функция для перевода файла в строку (Base64)
    const fileToBase64 = (file) => new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result);
        reader.onerror = error => reject(error);
    });

    function render(filter = '') {
        notesEl.innerHTML = '';
        notes.forEach((n, i) => {
            if (n.title.toLowerCase().includes(filter) || n.text.toLowerCase().includes(filter)) {
                const el = document.createElement('div');
                el.className = 'note-card';
                el.innerHTML = `<strong>${n.title}</strong><p>${n.text.substring(0, 30)}...</p>`;
                el.onclick = () => openNote(i);
                notesEl.appendChild(el);
            }
        });
    }

    function openNote(i) {
        current = i;
        const n = notes[i];
        titleInput.value = n.title;
        textInput.value = n.text;
        viewTitle.textContent = n.title;
        viewText.textContent = n.text;
        mediaArr = [...(n.media || [])];
        drawMedia();
        modal.classList.add('active');
    }

    document.querySelector('.add-btn').onclick = () => {
        current = null;
        titleInput.value = '';
        textInput.value = '';
        viewTitle.textContent = 'Новая заметка';
        viewText.textContent = '';
        mediaArr = [];
        drawMedia();
        modal.classList.add('active');
    };

    document.getElementById('close').onclick = () => modal.classList.remove('active');

    document.getElementById('save').onclick = () => {
        if (!titleInput.value.trim()) return;
        const note = {
            title: titleInput.value,
            text: textInput.value,
            media: mediaArr // Здесь уже лежат Base64 строки
        };
        if (current !== null) {
            notes[current] = note;
        } else {
            notes.push(note);
        }
        localStorage.setItem('notes', JSON.stringify(notes));
        modal.classList.remove('active');
        render();
    };

    document.getElementById('delete').onclick = () => {
        if (current === null) return;
        notes.splice(current, 1);
        localStorage.setItem('notes', JSON.stringify(notes));
        modal.classList.remove('active');
        render();
    };

    mediaInput.on
