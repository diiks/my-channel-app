<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DIX</title>

<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:system-ui}
body{background:#004d33;color:white;min-height:100vh}

header{
  background:#000;
  padding:18px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.logo{font-size:30px;font-weight:800;color:#39ff14}

.search{
  width:170px;
  padding:10px 14px;
  border-radius:16px;
  border:none;
  background:#1a1a1a;
  color:white;
}

main{
  padding:18px;
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(170px,1fr));
  gap:16px;
}

.note{
  background:#000;
  border-radius:20px;
  padding:14px;
  font-weight:600;
  cursor:pointer;
  text-align:center;
}

.add-btn{
  position:fixed;
  bottom:22px;
  right:22px;
  width:64px;
  height:64px;
  border-radius:50%;
  background:#000;
  color:#39ff14;
  font-size:36px;
  border:none;
}

.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.85);
  display:none;
  justify-content:center;
  align-items:center;
  overflow-y:auto;
  padding:30px 0;
}

.modal.active{display:flex}

.card{
  background:#0f0f0f;
  width:95%;
  max-width:480px;
  border-radius:26px;
  padding:20px;
  display:flex;
  flex-direction:column;
  gap:14px;
  position:relative;
  max-height:90vh;
  overflow-y:auto;
}

.close{
  position:absolute;
  top:6px;
  right:10px;
  font-size:24px;
  cursor:pointer;
}

input,textarea{
  background:#1c1c1c;
  border:1px solid #333;
  border-radius:16px;
  padding:12px;
  color:white;
}

textarea{
  min-height:180px;
  resize:none;
}

.media-view{
  position:relative;
  overflow:hidden;
  border-radius:18px;
  margin-top:10px;
  width:100%;
  height:240px;
}

.media-track{
  display:flex;
  transition:transform 0.3s ease;
  height:100%;
}

.media-track img,
.media-track video{
  flex-shrink:0;
  width:100%;
  height:100%;
  object-fit:contain; /* —Ñ–æ—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é */
  border-radius:18px;
}

.media-counter{
  text-align:center;
  margin-top:4px;
  font-size:14px;
  opacity:0.7;
}

.actions{
  display:flex;
  align-items:center;
  gap:10px;
  margin-top:6px;
}

.btn{
  flex:1;
  padding:12px;
  border-radius:18px;
  border:none;
  background:#222;
  color:white;
  cursor:pointer;
}

.delete{background:#ff3b3b}

.camera{
  width:56px;
  height:56px;
  border-radius:12px;
  background:#222;
  color:white;
  font-size:26px;
  border:none;
}

.fullscreen{
  position:fixed;
  inset:0;
  background:black;
  display:none;
  justify-content:center;
  align-items:center;
  z-index:999;
}

.fullscreen img,
.fullscreen video{
  max-width:100%;
  max-height:100%;
  object-fit:contain;
  cursor:pointer;
}
</style>
</head>

<body>

<header>
  <div class="logo">DIX</div>
  <input class="search" placeholder="–ü–æ–∏—Å–∫">
</header>

<main id="notes"></main>
<button class="add-btn">+</button>

<div class="modal" id="modal">
  <div class="card" id="card">
    <div class="close" id="close">‚úñ</div>

    <input id="title" placeholder="–¢–µ–º–∞">
    <textarea id="text" placeholder="–¢–µ–∫—Å—Ç –∑–∞–º–µ—Ç–∫–∏"></textarea>

    <div class="media-view" id="mediaView">
      <div class="media-track" id="mediaTrack"></div>
    </div>
    <div class="media-counter" id="mediaCounter"></div>

    <input type="file" id="media" accept="image/*,video/*" multiple hidden>

    <div class="actions">
      <button class="btn delete" id="delete">–£–¥–∞–ª–∏—Ç—å</button>
      <button class="camera" id="addMedia">üì∏</button>
      <button class="btn" id="save">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>
  </div>
</div>

<div class="fullscreen" id="fullscreen"></div>

<script>
let notes = JSON.parse(localStorage.getItem('notes')||'[]');
let current = null;
let mediaArr = [];
let mediaIndex = 0;
let startX=0;

const notesEl = document.getElementById('notes');
const modal = document.getElementById('modal');
const card = document.getElementById('card');
const titleInput = document.getElementById('title');
const textInput = document.getElementById('text');
const mediaInput = document.getElementById('media');
const mediaView = document.getElementById('mediaView');
const mediaTrack = document.getElementById('mediaTrack');
const mediaCounter = document.getElementById('mediaCounter');
const fullscreen = document.getElementById('fullscreen');

function render(){
  notesEl.innerHTML='';
  notes.forEach((n,i)=>{
    const d=document.createElement('div');
    d.className='note';
    d.textContent=n.title;
    d.onclick=()=>openNote(i);
    notesEl.appendChild(d);
  });
}

function openNote(i){
  current=i;
  const n=notes[i];
  titleInput.value = n.title;
  textInput.value = n.text;
  mediaArr = [...n.media];
  mediaIndex = 0;
  drawMedia();
  modal.classList.add('active');
}

document.querySelector('.add-btn').onclick = ()=>{
  current = null;
  titleInput.value = '';
  textInput.value = '';
  mediaArr = [];
  mediaIndex = 0;
  drawMedia();
  modal.classList.add('active');
};

document.getElementById('close').onclick = ()=>modal.classList.remove('active');

document.getElementById('save').onclick = ()=>{
  if(!titleInput.value.trim()) return;
  const note = {title:titleInput.value, text:textInput.value, media:mediaArr};
  if(current!==null) notes[current]=note; else notes.push(note);
  localStorage.setItem('notes', JSON.stringify(notes));
  modal.classList.remove('active');
  render();
};

document.getElementById('delete').onclick = ()=>{
  if(current===null) return;
  notes.splice(current,1);
  localStorage.setItem('notes', JSON.stringify(notes));
  modal.classList.remove('active');
  render();
};

document.getElementById('addMedia').onclick = ()=>mediaInput.click();

mediaInput.onchange = ()=>{
  [...mediaInput.files].forEach(file=>{
    const reader = new FileReader();
    reader.onload = ()=>{
      mediaArr.push({type:file.type, data:reader.result});
      drawMedia();
    };
    reader.readAsDataURL(file);
  });
};

function drawMedia(){
  mediaTrack.innerHTML='';
  if(!mediaArr.length){ mediaCounter.textContent=''; return; }

  mediaArr.forEach(m=>{
    const el = document.createElement(m.type.startsWith('image')?'img':'video');
    el.src = m.data;
    el.controls = m.type.startsWith('video');
    mediaTrack.appendChild(el);
  });

  updateMediaView();
}

function updateMediaView(){
  const offset = -mediaIndex * mediaView.offsetWidth;
  mediaTrack.style.transform = `translateX(${offset}px)`;
  mediaCounter.textContent = mediaArr.length?`${mediaIndex+1}/${mediaArr.length}`:'';
}

mediaView.addEventListener('touchstart', e=>{startX=e.touches[0].clientX;});
mediaView.addEventListener('touchend', e=>{
  const dx = e.changedTouches[0].clientX - startX;
  if(dx>50 && mediaIndex>0) mediaIndex--;
  if(dx<-50 && mediaIndex<mediaArr.length-1) mediaIndex++;
  updateMediaView();
});

/* SWIPE LEFT TO CLOSE MODAL */
card.addEventListener('touchstart', e=>{startX=e.touches[0].clientX;});
card.addEventListener('touchend', e=>{
  const dx = e.changedTouches[0].clientX - startX;
  if(dx<-80) modal.classList.remove('active');
});

/* FULLSCREEN PHOTO/VIDEO */
mediaTrack.addEventListener('click', ()=>{
  fullscreen.innerHTML = mediaTrack.innerHTML;
  fullscreen.style.display='flex';
});
fullscreen.onclick = ()=>fullscreen.style.display='none';

/* SEARCH */
document.querySelector('.search').oninput=e=>{
  const q=e.target.value.toLowerCase();
  [...notesEl.children].forEach((el,i)=>{
    const n=notes[i];
    el.style.display = n.title.toLowerCase().includes(q)||n.text.toLowerCase().includes(q)?'flex':'none';
  });
};

render();
</script>
</body>
</html>